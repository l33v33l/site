<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript</title>
  </head>
  <body>
    <!-- 
    <script>
      function countRabbits() {
        for (let i = 1; i <= 3; i++) {
          alert("Rabbit number " + i);
        }
      }
    </script>

    <input type="button" onclick="countRabbits()" value="Count rabbits!" />
    -->

    <!-- https://javascript.info/introduction-browser-events -->

    <!-- Ce tutoriel : https://www.youtube.com/watch?v=DqaTKBU9TZk
    -->

    <input id="todo-title" type="text" />
    <input id="date-picker" type="date" />
    <!-- Utiliser une boîte d'input de texte pour saisir une nouvelle valeur -->
    <button onclick="addTodo()">Ajouter la tâche dans la liste</button>
    <!-- Mieux de rajouter la fonction ici dans onclick -->

    <button onclick="removeTodo()">Effacer un élément de la liste</button>
    <br />

    <!-- Div ça produit une boîte autour du texte -->

    <div id="todo-list"></div>

    <script>
      // Section model selon MVC. Ça contient les données.
      /* MVC : model, view, controller
           Model : contient le code qui sauvegarde et gère les données.
           View : code qui gère les visuels. Produit en fonction du data (model)
           Controller : connecte model et view ensemble.
             1) RÉpondre aux événement de view (ex. : click de button)
             2) Dit au model de mettre à jour son data et de même pour les views.

       */

      // MODEL

      // Si localStroage a déjà un tableau, alors l'utiliser, sinon, utiliser le tableau par défaut.
      /* let todos;

      // JE N'AI PAS INCLUS LA PARTIE SAVED TODO ET LOCAL STORAGE VU QUE ÇA NE FONCTIONNE PAS.

       const savedTodos = JSON.parse(localStorage.getItem("todos"));
       if (Array.isArray(savedTodos)) {
         todos = savedTodos;
       } else {
         */

      let todos = [
        { title: "Get groceries", dueDate: "2021-10-04", id: "id1" },
        { title: "Wash car", dueDate: "2021-02-03", id: "id2" },
        { title: "Make dinner", dueDate: "2021-05-10", id: "id3" },
      ];

      //On n'est pas obligé d'assigner des valeurs à une variable quand elle est créé, à moins que cette variable soit une constante (const).

      // On peut créer des objets qui contiennent des éléments qui sont liés. Ex. let todo = {title: "Get groceries", dueDate:"2021-10-04"}
      // todo.tile = "Get groceries"

      // Différence entre var, let et const : https://www.freecodecamp.org/news/var-let-and-const-whats-the-difference/
      /* Création d'un tableau */

      // Section qui créer les todos devraient être dans la section model vu que ça créer le data.

      function createTodo(title, dueDate) {
        const id = "" + new Date().getTime();
        // Il y a un problème là vu que ça retourne un nombre et non un string. Le problème est que dans la fonction delete on compare ça à un string (voir la propriété id).
        // Donc, la solution est de rajouter un string vide pour convertir en string.

        todos.push({ title: title, dueDate: dueDate, id: id });

        // saveTodos();
      }
      // Deletes a todo
      function removeTodo(idToDelete) {
        todos = todos.filter(function (todo) {
          // Si l'id du todo match l'id à effacer, alors retourner faux.
          if (todo.id === idToDelete) {
            return false;
          } else {
            return true;
          }
        });
        // saveTodos();
      }

      /* 
      function saveTodos() {
        //Local storage : emmagasiner des données puis retrouver avec une clef.
        // Ça ne peut sauvegarder que des strings.
        localStorage.setItem("todos", JSON.stringify(todos));
        //Donc, convertir en string les valeurs du tableau.
      }
      */

      // Controller
      function addTodo() {
        const textbox = document.getElementById("todo-title");
        /* La valeur saisie dans input */
        const title = textbox.value;
        /* Aller chercher la valeur */
        const datePicker = document.getElementById("date-picker");
        const dueDate = datePicker.value;

        createTodo(title, dueDate);
        render();
      }

      function deleteTodo(event) {
        const deleteButton = event.target;
        const idToDelete = deleteButton.id;

        removeTodo(idToDelete);
        render();
      }

      // VIEW
      function render() {
        // Le problème c'est que l'entièreté de la liste est affichée à chaque fois.
        // Donc, le tutoriel propose : reset la liste à chaque fois. Avec document.body.innerHTML, qui efface la valeur de la la page.
        document.getElementById("todo-list").innerHTML = "";

        //Afficher le contenu de la liste mis-à-jour
        todos.forEach(function (todo) {
          /* Avoir créé la variable formelle ou paramètre pour la réutiliser dans la fonction */
          let element = document.createElement("div");
          element.innerText = todo.title + " " + todo.dueDate;

          const deleteButton = document.createElement("button");
          deleteButton.innerHTML = "Delete";
          deleteButton.style = "margin-left:12px";
          // Exemple de document objet model : on peut prendre un élément html et l'utilisé dans JavaScript
          deleteButton.onclick = deleteTodo;
          deleteButton.id = todo.id;
          element.appendChild(deleteButton);
          /* Pour changer le texte dans l'élément */
          let todoList = document.getElementById("todo-list");
          todoList.appendChild(element);
        });
      }

      render();

      /*  alert(todos);
             todos.push("Do laundry");
             /* Ajouter un élément au tableau
             alert("Voici la liste avec un élément de plus : \n " + todos);

             todos.pop();
             /* Enlever le dernier élément de la liste
             alert("Voici la liste avec un élément de moins : \n " + todos);
       */

      /* Les strings ont aussi des méthodes
             console.log('hello'.toUpperCase());
       */

      /* Rendu à 30:48 */

      /*   alert("hello");
             alert(typeof todo1);
             alert(todo1 + todo2);
           */

      /* Plus besoin de ça vu qu'on a entré la fonction dans la boucle for :

           function addTodo(todoTitle) {
               let element = document.createElement("div");
               element.innerText = todoTitle;
               document.body.appendChild(todoTitle;
             }
           */

      /* Plus besoin de ça si on utilise la boucle for :

             addTodo(todo3);
             addTodo(todo2);
             addTodo(todo1);
             */

      /*
             let element = document.createElement("div");
             element.innerText = todo1;
             /* Pour changer le texte dans l'élément */
      /*
             document.body.appendChild(element);
             */

      /* Pour réutiliser l'élément element et lui réassigner une autre valeur sans utiliser une fonction
             element = document.createElement("div");
             element.innerText = todo2;
             document.body.appendChild(element);
               */

      /* On peut créer des éléments et les sauvegarder en javascript */
    </script>

    <!-- On peut créer une fonction avec javascript.-->
    <!-- Javascript ne fonctionne pas tout seul. Il doit être utilisé à l'intérieur de HTML-->
    <!-- JavaScript est le seul language qui peut rouler dans un navigateur web. -->
    <!-- let permet de créer une variable. 
          typeof nomDeLaVariable : va afficher le type
          on peut utiliser + pour concaténer deux strings ensemble.
      -->

    <!--Va remplacer la page par ce qui est entre guillemets document.body.innerHTML ='hello'; -->
    <!--Va afficher dans la console le texte console.log('hi') -->

    <!-- 
          Alert : https://www.w3schools.com/jsref/met_win_alert.asp
          Script : https://www.w3schools.com/tags/tag_script.asp
      -->
  </body>
</html>
